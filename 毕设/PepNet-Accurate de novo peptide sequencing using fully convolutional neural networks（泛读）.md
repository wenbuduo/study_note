 PepNet，一种用于高精度从头肽测序的全卷积神经网络。 PepNet 将 MS/MS 谱（表示为高维向量）作为输入，并输出最佳肽序列及其置信度得分。 PepNet 模型使用来自多个人类肽谱库的总共 300 万个高能碰撞解离 MS/MS 谱图进行训练。PepNet 在 GPU 上的运行速度分别比 PointNovo 和 DeepNovo 快 3 倍和 7 倍，因此更适合大规模蛋白质组数据的分析。
## Q：问题背景
- 在典型的蛋白质组学实验中，获得 MS/MS 谱图后，第一步（可以说是最重要的步骤）是从这些谱图中识别肽。人们开发了许多算法来解决这个问题，这些算法主要分为三类：蛋白质数据库搜索、光谱库搜索和从头测序。蛋白质数据库搜索是肽鉴定的主要方法。将实验光谱与蛋白质数据库中肽生成的理论光谱进行比较，并报告那些可能真实的肽光谱匹配 (PSM)。
- 光谱库搜索方法将新采集的 MS/MS 光谱与包含早期计算分析中使用的先前表征的实验光谱的库进行比较。由于 MS/MS 数据的重复性和再现性得到改善，以及大量实验光谱的可用性不断提高，从头测序算法尝试直接从其 MS/MS 谱图中导出肽序列，而不使用谱库或蛋白质序列数据库等参考文献。
- 许多从头测序算法采用图论公式来计算谱图中的最长路径图表通过采用动态规划算法和自适应评分方案
- 利用深度神经网络 (DNN) 架构来捕获依赖性输入串联质谱中的碎片离子，随后用于按顺序构建肽
存在的挑战：
- 比传统的从头测序算法表现出更好的性能，但我们观察到它们可以对相对较少的长肽进行测序，特别是来自电荷 3+ MS/MS 谱图，这可能是由于对碎片离子之间复杂的长程模式进行建模的挑战。另一方面，PredFull采用的卷积神经网络 (CNN) 架构进行完整的 MS/MS 谱预测，证明了 CNN 在学习 MS/MS 谱中复杂模式方面的优势。


## Q：解决了什么挑战（简单）
![[Pasted image 20241118203920.png]]
如图 所示，我们模型的输入是一个 20,480 × 4 矩阵，表示输入频谱（有关详细信息，请参阅方法部分）。输入矩阵将经过五个连续时间卷积网络 (TCN) 块30和下采样层来捕获观察到的峰值之间的关系，如图  的 TCN 分支所示。这五个 TCN 块在不同的分辨率级别上工作，捕获全局和光谱的局部信息，并且使用合并分支（图1中的自下而上分支）将全局和局部信息融合成单个特征张量。然后特征张量由 softmax 解码层转换为大小的概率矩阵32×23，其中每列包含肽中相应位置处目标氨基酸的softmax概率（如补充图S1所示）。这里，概率矩阵中的 32 列代表目标肽中最多 30 个位置（最大长度为 30）、一个结束字符和一个或多个填充字符。 23行代表以下字符的one-hot概率：20个标准氨基酸字符（在该位置）、1个起始字符（为兼容性保留但当前未使用）、1个结束字符和1个填充字符。从最终的概率矩阵中，我们通过选择每个位置概率最高的氨基酸来推导出最佳肽序列。此外，特征张量还被发送到几个相对简单的辅助任务（图1中的辅助任务分支），以指导和正则化目标从头测序任务。
## Q：文章所做的贡献
- 不强迫模型输出具有匹配前体质量的肽；相反，我们设计损失函数来鼓励模型输出包含**尽可能多的正确氨基酸的肽序列**。这种方法可以防止模型输出具有所需氨基酸组成的肽，但忽略输入 MS/MS 谱中的序列信息，特别是在训练过程的早期阶段，当模型没有学到足够的知识时。
- PepNet 的性能在各种生物体中保持一致，并且在位置精度方面始终高于 PointNovo 和 DeepNovo。PepNet 在来自这些生物体的蛋白质组数据上的性能与在人类蛋白质组数据上的性能相当，这表明尽管 PepNet 是使用主要来自人类肽的 MS/MS 谱图进行训练的，该模型可以很好地推广用于非人类肽的从头测序。计算每个测序肽的质量得分，作为测序肽中所有氨基酸的概率的乘积。
- PepNet 采用的多任务学习（MTL）策略可能有助于其在电荷 3+ 谱上的性能
- PepNet 产生的从头测序结果与数据库搜索引擎（例如 MaxQuant）是互补的。未被数据库搜索引擎识别的肽/蛋白质可能会导致发现蛋白质组样品中表达的其他肽/蛋白质，即生成的蛋白但与蛋白质数据库中的任何序列都不匹配。
- PepNet 能够对更长（因此更复杂）的肽进行测序
## Q：实现步骤
### MS/MS谱的表示方法

1. **一维向量表示**：输入的MS/MS谱被表示为一个一维（1-D）向量。这是通过将谱进行分箱（binning）处理来实现的，即将谱数据按一定的宽度划分成多个区间。
2. **m/z范围**：考虑到大多数实验谱中m/z（质量对电荷比）在0到2000之间，因此仅选择这个范围内的峰进行分析。超出这个范围的峰被忽略，因为它们在实际实验中不常见。
3. **分箱宽度**：默认的分箱宽度为0.1 Th（质谱单位），这将产生一个20,000维的向量表示。这样的分箱宽度能够平衡解析度和计算效率。
4. **分辨率与性能**：实验表明，使用更小的分箱宽度（即更高的质量分辨率）不会显著提升de novo测序的性能，但会增加计算时间，这表明在性能和效率之间存在权衡。
5. **前体峰的去除与归一化**：在每个谱中移除前体峰（precursor peak），并通过将每个峰值除以该谱中最大峰值的强度来对谱进行归一化。这种处理方式类似于先前的研究，有助于消除不同谱之间的强度差异，使得后续的分析更加可靠。



### 深度神经网络架构

1. **PepNet模型**：PepNet模型主要基于时间卷积网络（Temporal Convolutional Network, TCN）结构，设计用于处理序列数据，特别适合捕捉MS/MS谱中远距离峰之间的潜在关联。
2. **感受野**：PepNet的设计目的是确保有足够的感受野来捕捉谱中远距离的相关性，同时保持相对较低的计算成本。感受野是指网络能够“看到”的输入数据的范围，这对于处理时序数据尤其重要。
3. **扩张卷积层**：TCN块由多个堆叠的扩张卷积层组成，扩张率以指数方式增长。通过堆叠更多的扩张层，TCN能够有效覆盖较大的感受野。这种结构使得模型可以同时捕捉局部和全局的特征。
4. **有效感受野的计算**：每个TCN块的有效感受野大小可以通过公式来计算：，其中表示扩张层的数量。这个公式揭示了通过增加卷积核大小和扩张层数，可以显著扩大模型的感受野。
具体是实现步骤：
1. **零填充**：首先，对每个谱图的向量表示进行零填充，将其维度从20,000扩展到20,480，以避免后续下采样层中的非整数维度。同时，m/z数组也以相同方式扩展为20,480维的向量。
2. **输入矩阵构建**：将这两个扩展后的向量及其逆向版本堆叠在一起，形成一个形状为20,480 × 4的输入矩阵。
3. **时间卷积网络（TCN）结构**：如图1所示，设计了五个连续的TCN块和下采样层，以捕捉观察到的峰之间的关系。下层TCN块具有较大的感受野但通道较少，而每个下采样层后的TCN块则感受野减半但通道数量增加约1.5倍。
4. **信息提取**：这些TCN块可以从输入的MS/MS谱中提取大部分信息，它们在不同的分辨率下工作，获得互补的信息：最顶层的TCN块强调输入谱的细节局部结构，而最底层的块则主要考虑谱的整体特征。
5. **特征融合**：为融合全局与局部信息，引入底部向上的分支，将所有TCN块的输出合并为一个单一的特征张量。
6. **元信息处理**：随后，将元信息（如谱的电荷、前体的m/z、已知的归一化碰撞能量等）通过线性层（带有Sigmoid激活函数）转换，并与之前的特征张量拼接，得到最终的特征张量。
7. **概率矩阵生成**：通过softmax解码层，将特征张量转换为32 × 23的概率矩阵。矩阵的每一列表示对应位置（20种标准氨基酸和3个特殊符号）每种氨基酸的概率。
8. **肽链序列推导**：通过选择每一列中概率最高的氨基酸，推导出最佳肽链序列，直到遇到最高概率的结束字符。如果推导出的肽链的理论质量与实验前体质量相差超过10 ppb，则尝试检查是否有次优肽链匹配前体质量：将每个位置的氨基酸替换为第二高概率的氨基酸，如果得到的肽链匹配前体质量，则作为最终的de novo测序结果输出；否则，报告原始的最佳肽链序列。
9. **辅助任务训练**：除了de novo测序任务外，还同时训练几个相对简单的辅助任务（如图1所示），以提高整体性能
## Q:启发是什么
PepNet模型对肽段预测提供了多个方面的启发，主要包括以下几点：
1. **数据表示与预处理**：
   - **谱的标准化与归一化**：PepNet通过移除前体峰和对谱进行归一化，确保数据一致性，消除不同实验条件下的变异。这一点对于提高模型的鲁棒性至关重要。
   - **分箱技术**：将MS/MS谱表示为固定维度的向量（如20,000维），能够有效保留谱中的关键信息，同时降低计算复杂度，可以为其他相关领域的数据处理提供参考。
2. **网络架构的选择**：
   - **利用时间卷积网络（TCN）**：PepNet采用了TCN，这种结构能够通过扩张卷积捕捉序列数据中的远程依赖性，这对于肽段序列预测至关重要。这个设计理念可以启发其他序列数据建模，如基因组学或自然语言处理中的长序列建模。
   - **感受野的设计**：有效的感受野设计使得模型能够捕捉局部与全局特征，可以在其他领域的模型设计中借鉴，以优化信息提取。
3. **训练数据集的构建与划分**：
   - **大规模数据集的构建**：通过整合多个肽谱库并确保数据集的多样性和代表性，有助于提高模型的泛化能力。这种方法可以激励其他领域在数据收集和处理上的策略。
   - **避免信息泄漏**：确保训练集、验证集和测试集之间没有重叠数据，以避免过拟合。这一点在机器学习中的各种应用中都是重要的实践。
4. **优化与训练策略**：
   - **使用RAdam优化器**：通过选择合适的优化算法和学习率策略，可以加速收敛并提高模型性能。这为其他复杂模型的训练提供了启发，强调了优化过程的重要性。
   - **选择最佳模型权重**：在验证集上表现最佳的模型权重选择策略帮助确保最终模型的可靠性。这一策略可以应用于其他需要模型调优的领域。
5. **多任务学习的潜力**：
   - **辅助任务的设计**：在PepNet中引入辅助任务提高了主任务的性能，说明在模型训练中，多任务学习可以有效利用不同的任务信息，提升整体效果。这种策略可以在其他领域的模型设计中得到借鉴。
通过这些启发，PepNet不仅推动了肽段预测的进步，也为相关领域的研究提供了有价值的方法论和技术框架。